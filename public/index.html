<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Super Admin - Padel</title>
</head>
<body>
  <h1>Login</h1>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Ingresar</button>

  <hr>

  <h2>Crear Club</h2>
  <input type="text" id="nombre" placeholder="Nombre del club">
  <input type="text" id="direccion" placeholder="Dirección">
  <input type="text" id="contacto_nombre" placeholder="Nombre de contacto">
  <input type="text" id="contacto_telefono" placeholder="Teléfono">
  <input type="text" id="logo" placeholder="URL del logo">
  <button onclick="crearClub()">Crear Club</button>

  <hr>

  <h2>Lista de Clubes</h2>
  <button onclick="getClubes()">Ver Clubes</button>
  <div id="resultado"></div>

  <hr>

  <h2>Crear Usuario Administrador</h2>
  <input type="text" id="usuario_nombre" placeholder="Nombre del usuario">
  <input type="email" id="usuario_email" placeholder="Email">
  <input type="password" id="usuario_password" placeholder="Password">
  <select id="usuario_club">
    <option value="">Selecciona un club</option>
  </select>
  <button onclick="crearUsuario()">Crear Usuario</button>

  <script>
    const baseUrl = 'https://padel-backend-ysw0.onrender.com';

    // LOGIN
    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const res = await fetch(`${baseUrl}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });

      const data = await res.json();
      if (data.token) {
        localStorage.setItem('token', data.token);
        alert('Login exitoso');
        cargarClubesSelect();
      } else {
        alert('Error: ' + (data.message || 'Credenciales inválidas'));
      }
    }

    // CREAR CLUB
    async function crearClub() {
      const token = localStorage.getItem('token');
      if (!token) return alert('Debes iniciar sesión primero');

      const club = {
        nombre: document.getElementById('nombre').value,
        direccion: document.getElementById('direccion').value,
        contacto_nombre: document.getElementById('contacto_nombre').value,
        contacto_telefono: document.getElementById('contacto_telefono').value,
        logo: document.getElementById('logo').value
      };

      const res = await fetch(`${baseUrl}/clubes`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(club)
      });

      const data = await res.json();
      alert(data.message || 'Club creado');
      getClubes();
      cargarClubesSelect();
    }

    // LISTAR CLUBES
    async function getClubes() {
      const token = localStorage.getItem('token');
      if (!token) return alert('Debes iniciar sesión primero');

      const res = await fetch(`${baseUrl}/clubes`, {
        headers: { 'Authorization': `Bearer ${token}` }
      });

      const data = await res.json();
      let html = '<table border="1" cellpadding="5"><tr><th>ID</th><th>Nombre</th><th>Acciones</th></tr>';
      data.forEach(club => {
        html += `<tr>
          <td>${club.id}</td>
          <td>${club.nombre}</td>
          <td><a href="/club/${club.id}" target="_blank">Ver página</a></td>
        </tr>`;
      });
      html += '</table>';
      document.getElementById('resultado').innerHTML = html;
    }

    // CARGAR CLUBES EN SELECT
    async function cargarClubesSelect() {
      const token = localStorage.getItem('token');
      if (!token) return;

      const res = await fetch(`${baseUrl}/clubes`, {
        headers: { 'Authorization': `Bearer ${token}` }
      });

      const data = await res.json();
      const select = document.getElementById('usuario_club');
      select.innerHTML = '<option value="">Selecciona un club</option>';
      data.forEach(club => {
        select.innerHTML += `<option value="${club.id}">${club.nombre}</option>`;
      });
    }

    // CREAR USUARIO ADMIN
    async function crearUsuario() {
      const token = localStorage.getItem('token');
      if (!token) return alert('Debes iniciar sesión primero');

      const usuario = {
        nombre: document.getElementById('usuario_nombre').value,
        email: document.getElementById('usuario_email').value,
        password: document.getElementById('usuario_password').value,
        rol: 'CLUB_ADMIN',
        club_id: document.getElementById('usuario_club').value
      };

      const res = await fetch(`${baseUrl}/usuarios`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(usuario)
      });

      const data = await res.json();
      alert(data.message || 'Usuario creado');
    }
  </script>
</body>
</html>